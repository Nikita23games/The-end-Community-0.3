<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE END | MARKET</title>
    <style>
        body { background: #000; color: #ff0; font-family: 'Courier New', monospace; margin: 0; padding: 20px; }
        .market-header { border-bottom: 2px solid #f00; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .box { border: 2px solid #f00; background: #0a0a0a; max-width: 500px; margin: 0 auto; padding: 20px; box-shadow: 0 0 15px #f00; }
        
        .shop-tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 10px; background: #111; border: 1px solid #f00; color: #f00; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        .tab-btn.active { background: #f00; color: #000; }

        .item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #200; padding: 10px 0; }
        .item-info { display: flex; align-items: center; gap: 15px; }
        .buy-btn { background: #f00; color: #000; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 11px; }
        .buy-btn:disabled { background: #333; color: #555; cursor: not-allowed; }
        
        .back-btn { color: #f00; text-decoration: none; font-weight: bold; border: 1px solid #f00; padding: 5px 15px; text-transform: uppercase; font-size: 12px; }
        .title-preview { font-weight: bold; color: #ffd700; text-shadow: 0 0 5px #aa8800; }
        img { object-fit: cover; background: #111; }
    </style>
</head>
<body>

    <div class="market-header">
        <a href="index.html" class="back-btn">⬅ НАЗАД В СИСТЕМУ</a>
        <div id="wallet" style="color:#f00; font-weight:bold; font-size: 18px;">0 💀</div>
    </div>

    <div class="box">
        <div class="shop-tabs">
            <button id="tab-a" class="tab-btn active" onclick="switchTab('avatars')">АВАТАРЫ</button>
            <button id="tab-t" class="tab-btn" onclick="switchTab('titles')">ТИТУЛЫ</button>
        </div>

        <div id="shop-list"></div>
    </div>

    <script>
        const DB_U = 'sys_users_v35'; 
        let user = JSON.parse(localStorage.getItem('sys_session'));
        let currentTab = 'avatars';

        const marketData = {
            avatars: [
                {n: "Red Skull", p: 25, url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQC95YVuU8ngSwiQ5hILkn0ZcEzhLOBcRjRfBiP-3OnGg&s=10"},
                {n: "Cartoon Cat", p: 35, url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSaTs4cQbDFBP_I4gExo0qQ_lVFq9UVpkmLEyD4w6XllA&s=10"},
                {n: "Void Watcher", p: 50, url: "https://images.cults3d.com/FpLndx40oAirTek8cU1qBqJPWlk=/516x516/filters:no_upscale()/https://fbi.cults3d.com/uploaders/22935284/illustration-file/5c7bb7ff-eb23-4bc9-842b-b9ae45e10e9e/VoidWatcher_Cover.jpg"}
            ],
            titles: [
                {n: "The Pope", p: 20},
                {n: "Serial Killer", p: 25},
                {n: "Mind Demon", p: 40},
                {n: "System Error", p: 60},
                {n: "God of Void", p: 100}
            ]
        };

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('tab-a').classList.toggle('active', tab === 'avatars');
            document.getElementById('tab-t').classList.toggle('active', tab === 'titles');
            renderShop();
        }

        function renderShop() {
            if(!user) {
                document.body.innerHTML = "<h1 style='color:red; text-align:center;'>ДОСТУП ЗАПРЕЩЕН. ВОЙДИТЕ В СИСТЕМУ.</h1>";
                return;
            }
            
            document.getElementById('wallet').innerText = `${user.karma} 💀`;
            const list = document.getElementById('shop-list');
            list.innerHTML = '';

            const items = marketData[currentTab];
            const inventory = currentTab === 'avatars' ? user.avaInventory : user.inventory;

            items.forEach(item => {
                const isOwned = inventory.includes(item.n);
                const canAfford = user.karma >= item.p;

                list.innerHTML += `
                    <div class="item">
                        <div class="item-info">
                            ${currentTab === 'avatars' 
                                ? `<img src="${item.url}" style="width:50px; height:50px; border:1px solid #f00;" onerror="this.src='https://via.placeholder.com/50/200?text=?'">`
                                : `<span class="title-preview">[${item.n}]</span>`
                            }
                            <div>
                                <div style="color:#fff; font-size:14px; font-weight:bold;">${item.n}</div>
                                <div style="color:#f00; font-size:11px;">ЦЕНА: ${item.p} 💀</div>
                            </div>
                        </div>
                        <button class="buy-btn" 
                            ${isOwned || !canAfford ? 'disabled' : ''} 
                            onclick="buyItem('${item.n}', ${item.p})">
                            ${isOwned ? 'КУПЛЕНО' : 'КУПИТЬ'}
                        </button>
                    </div>
                `;
            });
        }

        function buyItem(name, price) {
            if (user.karma < price) return;
            user.karma -= price;
            
            if (currentTab === 'avatars') {
                if (!user.avaInventory.includes(name)) user.avaInventory.push(name);
            } else {
                if (!user.inventory.includes(name)) user.inventory.push(name);
            }

            let users = JSON.parse(localStorage.getItem(DB_U) || '{}');
            users[user.nick] = user;
            localStorage.setItem(DB_U, JSON.stringify(users));
            localStorage.setItem('sys_session', JSON.stringify(user));

            renderShop();
            alert(`ВЫ ПРИОБРЕЛИ: ${name}`);
        }

        renderShop();
    </script>
</body>
</html>